<!doctype html>

<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>心の星｜Multebaer</title>
  <link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
	<link href="https://www.jqueryscript.net/demo/Responsive-Touch-enabled-jQuery-Image-Lightbox-Plugin/dist/simple-lightbox.min.css" rel="stylesheet" type="text/css">
</head>
<!-- ✅ Navbar 動態載入 -->
  <div id="navbar-container"></div>
<body class="iframe-body main-page">
	<div class="background-overlay"></div>
	<div class="gallery-box">
  <!-- 圖片瀑布流 -->
	    <div id="photos__container">
      <div class="photo">
    <img src="/images/Dazai001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai002.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Fleud001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/OC001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Alice001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Gogol001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Akiko001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai003.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai004.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Gogol002.webp" alt="" onclick="showLightbox(this.src)">
  </div>
	</div>
		</div>
<!-- 點圖放大（lightbox） -->
  <div id="lightbox" class="lightbox" onclick="hideLightbox()">
    <img id="lightbox-img" src="" alt="">
  </div>
	
	    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://www.jqueryscript.net/demo/Responsive-Touch-enabled-jQuery-Image-Lightbox-Plugin/dist/simple-lightbox.jquery.min.js"></script>
<script>
window.onload = function() {
  create($("#zoomwall"));
  function create(blocks){
    resize(blocks.children().children());
  }
  function resize(blocks){
    var row = [];
    var top = -1;
    for (var c = 0; c < blocks.length; c++) {
      var block = blocks[c];
      if (block) {
        if (top == -1) {
          top = block.offsetTop;
        } else if (block.offsetTop != top) {
          resizeRow(row, calcRowWidth(row));
          row = [];
          top = block.offsetTop;
        }
        row.push(block);
      }
    }
    resizeRow(row, calcRowWidth(row));
  }
  function resizeRow(row, width){
    if (row && row.length > 1) {
      for (var i in row) {
        row[i].style.width = (parseInt(window.getComputedStyle(row[i]).width, 10) / width * 100) + '%';
        row[i].style.height = 'auto';
      }
    }
  }
  function calcRowWidth(row){
    var width = 0;
    for (var i in row) {
      width += parseInt(window.getComputedStyle(row[i]).width, 10);
    }
    return width;
  }
};
$(function(){
  var gallery = $('.gallery a').simpleLightbox({navText:    ['&lsaquo;','&rsaquo;']});
});
</script>

<script>const gap = 14
const photosContainer= document.getElementById('photos__container')
const photos = document.getElementsByClassName('photo')

function cascadeDisplay() {
  const photosContainerWidth = photosContainer.offsetWidth
  const photoWidth = photos[0].offsetWidth
  // 計算一列最多有幾欄
  const columnsCount = parseInt((photosContainerWidth) / ( photoWidth + gap ))
  const fistRowPhotosHeightArray = []
  // 進行照片排序
  for (let i = 0; i < photos.length; i++) {
    // 放上第一列的照片
    if (i < columnsCount) {
      photos[i].style.top = 0
      photos[i].style.left = (photoWidth + gap) * i + 'px'
      // 紀錄第一列的照片高
      fistRowPhotosHeightArray.push(photos[i].offsetHeight)
    } else {
      // 放上第二列開始的照片
      // 找出第一列的最小高度
      let minHeight = Math.min(...fistRowPhotosHeightArray)
      // 紀錄最小高度的index，以取得對應到第一列的位置，來決定left要移動多少
      let index = fistRowPhotosHeightArray.indexOf(minHeight)
      // 調整接續的photo位置，放到目前最小高度的地方
      photos[i].style.top = minHeight + gap + 'px'
      // 取得對應到第一列photo的left位置
      photos[i].style.left = photos[index].offsetLeft + 'px'
      // 最後!!再把原本儲存在陣列裡面為最小高度的值，更新上最新的高度(原本的高度+新的高度+間隔)
      fistRowPhotosHeightArray[index] = fistRowPhotosHeightArray[index] + photos[i].offsetHeight + gap
    }
  }

}

// 畫面一進來
window.onload = function() {
  cascadeDisplay()
}

// 畫面寬度有變動
window.onresize = function() {
  cascadeDisplay()
}
	</script>
	
	<!--navbar-->
		 <script>
    fetch("/navbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar-container").innerHTML = html;
      });
  </script>
	
	<script>
  function navigateTo(page, event) {
    if (event) event.preventDefault();

    const cleanUrl = '/' + page.replace(/\.html$/, '').replace(/^\/+/, '');
    const htmlPath = page.replace(/^\/+/, '');

    history.pushState({}, "", cleanUrl);

    fetch(htmlPath)
      .then(res => {
        if (!res.ok) throw new Error("Page not found: " + htmlPath);
        return res.text();
      })
      .then(html => {
        document.getElementById("content-container").innerHTML = html;
      })
      .catch(err => {
        console.error("載入失敗", htmlPath);
        document.getElementById("content-container").innerHTML = "<h2>頁面載入失敗</h2>";
      });
  }

  function getHtmlPathFromUrl(urlPath) {
    const trimmed = urlPath.replace(/^\/+/, '').replace(/\/$/, '');
    return trimmed === '' ? 'iframe.html' : trimmed + '.html';
  }

  window.addEventListener("DOMContentLoaded", () => {
    const page = getHtmlPathFromUrl(location.pathname);
    navigateTo(page);
  });

  window.addEventListener("popstate", () => {
    const page = getHtmlPathFromUrl(location.pathname);

    fetch(page)
      .then(res => {
        if (!res.ok) throw new Error("Page not found: " + page);
        return res.text();
      })
      .then(html => {
        document.getElementById("content-container").innerHTML = html;
      })
      .catch(err => {
        console.error("載入失敗", page);
        document.getElementById("content-container").innerHTML = "<h2>頁面載入失敗</h2>";
      });
  });
</script>
</body>
</html>
