<!doctype html>

<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¿ƒã®æ˜Ÿï½œMultebaer</title>
  <link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>
<!-- âœ… Navbar å‹•æ…‹è¼‰å…¥ -->
  <div id="navbar-container"></div>
<body class="iframe-body main-page">
	<div class="background-overlay"></div>
	<div class="gallery-box">
  <!-- åœ–ç‰‡ç€‘å¸ƒæµ -->
	    <div id="photos__container">
      <div class="photo">
    <img src="/images/Dazai001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai002.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Fleud001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/OC001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Alice001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Gogol001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Akiko001.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai003.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Dazai004.webp" alt="" onclick="showLightbox(this.src)"></div>
    <div class="photo"><img src="/images/Gogol002.webp" alt="" onclick="showLightbox(this.src)">
  </div>
	</div>
		</div>
<!-- é»åœ–æ”¾å¤§ï¼ˆlightboxï¼‰ --><div id="lightbox" style="display: none;">
  <div class="lightbox-content">
    <span class="lightbox-btn left" id="lightbox-prev">&#10094;</span>
	  <div class="lightbox-image-wrapper">
    <img id="lightbox-img" src="">
		  </div>
    <span class="lightbox-btn right" id="lightbox-next">&#10095;</span>
  </div>
  <span class="lightbox-close" id="lightbox-close">&times;</span>
</div>

	
	    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>let currentIndex = 0
const lightbox = document.getElementById('lightbox')
const lightboxImg = document.getElementById('lightbox-img')
const lightboxClose = document.getElementById('lightbox-close')
const lightboxPrev = document.getElementById('lightbox-prev')
const lightboxNext = document.getElementById('lightbox-next')

const photoImages = document.querySelectorAll('.photo img')

function showLightbox(src) {
  lightbox.style.display = 'flex'
  lightboxImg.src = src
  currentIndex = Array.from(photoImages).findIndex(img => img.src === src)
}

// é—œé–‰ç‡ˆç®±
lightboxClose.onclick = () => {
  lightbox.style.display = 'none'
}

// å·¦å³åˆ‡æ›
function showImageAt(index) {
  if (index >= 0 && index < photoImages.length) {
    lightboxImg.src = photoImages[index].src
    currentIndex = index
  }
}

lightboxPrev.onclick = () => showImageAt((currentIndex - 1 + photoImages.length) % photoImages.length)
lightboxNext.onclick = () => showImageAt((currentIndex + 1) % photoImages.length)

document.addEventListener('keydown', e => {
  if (lightbox.style.display === 'flex') {
    if (e.key === 'ArrowLeft') lightboxPrev.onclick()
    if (e.key === 'ArrowRight') lightboxNext.onclick()
    if (e.key === 'Escape') lightboxClose.onclick()
  }
})
lightbox.addEventListener('click', e => {
  if (e.target === lightbox) {
    lightbox.style.display = 'none'
  }
})

  </script>

<script>
const gap = 14
const photosContainer = document.getElementById('photos__container')
const photos = document.getElementsByClassName('photo')

// æ ¸å¿ƒæ’åˆ—é‚è¼¯
function cascadeDisplay() {
  const photosContainerWidth = photosContainer.offsetWidth
  const photoWidth = photos[0].offsetWidth
  const columnsCount = Math.floor(photosContainerWidth / (photoWidth + gap))
  const firstRowHeights = []

  for (let i = 0; i < photos.length; i++) {
    const photo = photos[i]
    if (i < columnsCount) {
      photo.style.top = '0px'
      photo.style.left = (photoWidth + gap) * i + 'px'
      firstRowHeights[i] = photo.offsetHeight
    } else {
      const minHeight = Math.min(...firstRowHeights)
      const index = firstRowHeights.indexOf(minHeight)
      photo.style.top = (minHeight + gap) + 'px'
      photo.style.left = photos[index].offsetLeft + 'px'
      firstRowHeights[index] += photo.offsetHeight + gap
    }
  }
}

// ğŸ§  ç­‰å¾…åœ–ç‰‡ + é«˜åº¦æ¸²æŸ“ç©©å®š
function waitForImagesAndHeights(callback, retry = 0) {
  const images = document.querySelectorAll('.photo img')
  const total = images.length
  let loaded = 0

  const allReady = () =>
    Array.from(images).every(img =>
      img.complete && img.naturalHeight > 0 && img.offsetHeight > 10
    )

  const checkAndRun = () => {
    if (allReady()) {
      callback()
    } else if (retry < 10) {
      // æ¯ 200ms é‡è©¦ä¸€æ¬¡ï¼Œæœ€å¤š 10 æ¬¡ï¼ˆç¸½ç­‰å¾… 2 ç§’ï¼‰
      setTimeout(() => waitForImagesAndHeights(callback, retry + 1), 200)
    } else {
      // å°±ç®—å†ä¸è¡Œï¼Œä¹Ÿå¼·è¡Œæ’ç‰ˆä¸€æ¬¡
      callback()
    }
  }

  images.forEach(img => {
    if (img.complete && img.naturalHeight > 0) {
      loaded++
    } else {
      img.onload = () => {
        loaded++
        if (loaded === total) checkAndRun()
      }
      img.onerror = () => {
        loaded++
        if (loaded === total) checkAndRun()
      }
    }
  })

  if (loaded === total) {
    checkAndRun()
  }
}

// é¦–æ¬¡ç•«é¢è¼‰å…¥
document.addEventListener("DOMContentLoaded", () => {
  waitForImagesAndHeights(() => {
    cascadeDisplay()
    setTimeout(cascadeDisplay, 500) // æœ€å¾Œä¿åº•è£œä¸€æ¬¡
  })
})

// è¦–çª—å°ºå¯¸è®Šå‹•
window.addEventListener("resize", () => {
  setTimeout(cascadeDisplay, 200)
})
</script>

	
<script>const gap = 14
const photosContainer= document.getElementById('photos__container')
const photos = document.getElementsByClassName('photo')

function cascadeDisplay() {
  const photosContainerWidth = photosContainer.offsetWidth
  const photoWidth = photos[0].offsetWidth
  // è¨ˆç®—ä¸€åˆ—æœ€å¤šæœ‰å¹¾æ¬„
  const columnsCount = parseInt((photosContainerWidth) / ( photoWidth + gap ))
  const fistRowPhotosHeightArray = []
  // é€²è¡Œç…§ç‰‡æ’åº
  for (let i = 0; i < photos.length; i++) {
    // æ”¾ä¸Šç¬¬ä¸€åˆ—çš„ç…§ç‰‡
    if (i < columnsCount) {
      photos[i].style.top = 0
      photos[i].style.left = (photoWidth + gap) * i + 'px'
      // ç´€éŒ„ç¬¬ä¸€åˆ—çš„ç…§ç‰‡é«˜
      fistRowPhotosHeightArray.push(photos[i].offsetHeight)
    } else {
      // æ”¾ä¸Šç¬¬äºŒåˆ—é–‹å§‹çš„ç…§ç‰‡
      // æ‰¾å‡ºç¬¬ä¸€åˆ—çš„æœ€å°é«˜åº¦
      let minHeight = Math.min(...fistRowPhotosHeightArray)
      // ç´€éŒ„æœ€å°é«˜åº¦çš„indexï¼Œä»¥å–å¾—å°æ‡‰åˆ°ç¬¬ä¸€åˆ—çš„ä½ç½®ï¼Œä¾†æ±ºå®šleftè¦ç§»å‹•å¤šå°‘
      let index = fistRowPhotosHeightArray.indexOf(minHeight)
      // èª¿æ•´æ¥çºŒçš„photoä½ç½®ï¼Œæ”¾åˆ°ç›®å‰æœ€å°é«˜åº¦çš„åœ°æ–¹
      photos[i].style.top = minHeight + gap + 'px'
      // å–å¾—å°æ‡‰åˆ°ç¬¬ä¸€åˆ—photoçš„leftä½ç½®
      photos[i].style.left = photos[index].offsetLeft + 'px'
      // æœ€å¾Œ!!å†æŠŠåŸæœ¬å„²å­˜åœ¨é™£åˆ—è£¡é¢ç‚ºæœ€å°é«˜åº¦çš„å€¼ï¼Œæ›´æ–°ä¸Šæœ€æ–°çš„é«˜åº¦(åŸæœ¬çš„é«˜åº¦+æ–°çš„é«˜åº¦+é–“éš”)
      fistRowPhotosHeightArray[index] = fistRowPhotosHeightArray[index] + photos[i].offsetHeight + gap
    }
  }

}

// ç•«é¢ä¸€é€²ä¾†
window.onload = function() {
  cascadeDisplay()
}

// ç•«é¢å¯¬åº¦æœ‰è®Šå‹•
window.onresize = function() {
  cascadeDisplay()
}
</script>
	<!--navbar-->
		 <script>
    fetch("/navbar.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("navbar-container").innerHTML = html;
      });
  </script>
	
	<script>
  function navigateTo(page, event) {
    if (event) event.preventDefault();

    const cleanUrl = '/' + page.replace(/\.html$/, '').replace(/^\/+/, '');
    const htmlPath = page.replace(/^\/+/, '');

    history.pushState({}, "", cleanUrl);

    fetch(htmlPath)
      .then(res => {
        if (!res.ok) throw new Error("Page not found: " + htmlPath);
        return res.text();
      })
      .then(html => {
        document.getElementById("content-container").innerHTML = html;
      })
      .catch(err => {
        console.error("è¼‰å…¥å¤±æ•—", htmlPath);
        document.getElementById("content-container").innerHTML = "<h2>é é¢è¼‰å…¥å¤±æ•—</h2>";
      });
  }

  function getHtmlPathFromUrl(urlPath) {
    const trimmed = urlPath.replace(/^\/+/, '').replace(/\/$/, '');
    return trimmed === '' ? 'iframe.html' : trimmed + '.html';
  }

  window.addEventListener("DOMContentLoaded", () => {
    const page = getHtmlPathFromUrl(location.pathname);
    navigateTo(page);
  });

  window.addEventListener("popstate", () => {
    const page = getHtmlPathFromUrl(location.pathname);

    fetch(page)
      .then(res => {
        if (!res.ok) throw new Error("Page not found: " + page);
        return res.text();
      })
      .then(html => {
        document.getElementById("content-container").innerHTML = html;
      })
      .catch(err => {
        console.error("è¼‰å…¥å¤±æ•—", page);
        document.getElementById("content-container").innerHTML = "<h2>é é¢è¼‰å…¥å¤±æ•—</h2>";
      });
  });
</script>
</body>
</html>
